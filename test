
function cleanup () {
        set +e
        echo "Cleaning up..."
        aws ec2 terminate-instances --instance-ids $INSTANCE_ID --output text > /dev/null
        aws ec2 wait instance-terminated --instance-ids $INSTANCE_ID
        aws ec2 delete-key-pair --key-name $SSHKEY
        aws ec2 delete-security-group --group-id $CUSTOM_SECURITY_GROUP_ID
        aws ec2 delete-subnet --subnet-id $SUBNET_ID
        aws ec2 delete-route-table --route-table-id $ROUTE_TABLE_ID
        aws ec2 detach-internet-gateway --internet-gateway-id $INTERNET_GATEWAY_ID --vpc-id $VPC_ID
        aws ec2 delete-vpc --vpc-id $VPC_ID
        rm -f ${SSHKEY}.pem
        echo "Done"
        exit
}

cleanup
